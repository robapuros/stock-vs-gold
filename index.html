<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Stock vs Gold - Compare Stock Prices in Gold | Real Value Calculator</title>
    <meta name="description" content="See stock prices measured in gold instead of fiat currency. Compare any stock's real purchasing power over time. Track market cap, P/E ratio, and key metrics in gold terms.">
    <meta name="keywords" content="stock price gold, stock vs gold, gold price comparison, real stock value, inflation adjusted stock price, stock market cap gold, stock gold calculator, gold standard stocks">
    <meta name="author" content="Stock vs Gold">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://stockvsgold.com/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://stockvsgold.com/">
    <meta property="og:title" content="Stock vs Gold - See Stock Prices in Real (Gold) Terms">
    <meta property="og:description" content="Compare any stock's price measured in gold instead of fiat. See the real value beyond inflation. Free tool with charts, market cap, and key metrics.">
    <meta property="og:image" content="https://stockvsgold.com/og-image.png">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://stockvsgold.com/">
    <meta name="twitter:title" content="Stock vs Gold - See Stock Prices in Real (Gold) Terms">
    <meta name="twitter:description" content="Compare any stock's price measured in gold instead of fiat. See the real value beyond inflation.">
    <meta name="twitter:image" content="https://stockvsgold.com/og-image.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    
    <!-- Schema.org structured data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Stock vs Gold",
        "description": "Compare stock prices measured in gold instead of fiat currency. Track real purchasing power over time.",
        "url": "https://stockvsgold.com",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* Dark theme (default) */
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-card-hover: rgba(255, 255, 255, 0.08);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #eee;
            --text-secondary: #888;
            --text-muted: #666;
            --gold: #ffd700;
            --gold-secondary: #ffb347;
            --positive: #4ade80;
            --negative: #f87171;
            --input-bg: #2a2a4a;
            --input-border: #3a3a5a;
        }
        
        [data-theme="light"] {
            --bg-primary: #f5f5f7;
            --bg-secondary: #ffffff;
            --bg-card: rgba(0, 0, 0, 0.03);
            --bg-card-hover: rgba(0, 0, 0, 0.06);
            --border-color: rgba(0, 0, 0, 0.1);
            --text-primary: #1a1a2e;
            --text-secondary: #555;
            --text-muted: #888;
            --gold: #c9a000;
            --gold-secondary: #e6a800;
            --positive: #16a34a;
            --negative: #dc2626;
            --input-bg: #ffffff;
            --input-border: #ddd;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s, color 0.3s;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 50px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }
        
        .theme-toggle:hover {
            background: var(--bg-card-hover);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--gold), var(--gold-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        
        input, select, button {
            padding: 12px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
        }
        
        input, select {
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--input-border);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--gold);
        }
        
        button {
            background: linear-gradient(90deg, var(--gold), var(--gold-secondary));
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: background 0.3s;
        }
        
        .stat-card:hover {
            background: var(--bg-card-hover);
        }
        
        .stat-card h3 {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .stat-card .change {
            font-size: 1.1rem;
            margin-top: 5px;
        }
        
        .stat-card .sub {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .positive { color: var(--positive); }
        .negative { color: var(--negative); }
        .gold { color: var(--gold); }
        
        .chart-container {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 15px;
            color: var(--text-secondary);
        }
        
        .toggle-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .toggle-container label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: var(--text-primary);
        }
        
        .toggle-container input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .metrics-section {
            margin-bottom: 30px;
        }
        
        .metrics-section h2 {
            color: var(--gold);
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .metric-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
            transition: background 0.3s;
        }
        
        .metric-card:hover {
            background: var(--bg-card-hover);
        }
        
        .metric-card .label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .metric-card .value {
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        .metric-card .gold-value {
            color: var(--gold);
            font-size: 0.95rem;
            margin-top: 3px;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 179, 71, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        [data-theme="light"] .highlight-box {
            background: linear-gradient(135deg, rgba(201, 160, 0, 0.1), rgba(230, 168, 0, 0.1));
            border: 1px solid rgba(201, 160, 0, 0.4);
        }
        
        .highlight-box h3 {
            color: var(--gold);
            margin-bottom: 15px;
        }
        
        .highlight-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .highlight-row:last-child {
            border-bottom: none;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: var(--text-secondary);
        }
        
        .error {
            background: rgba(248, 113, 113, 0.2);
            border: 1px solid var(--negative);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        footer a {
            color: var(--gold);
            text-decoration: none;
        }
        
        footer a:hover {
            text-decoration: underline;
        }
        
        /* SEO Content Section */
        .seo-content {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 1px solid var(--border-color);
        }
        
        .seo-content h2 {
            color: var(--gold);
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .seo-content h3 {
            color: var(--text-primary);
            margin: 25px 0 15px;
            font-size: 1.3rem;
        }
        
        .seo-content p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 15px;
            max-width: 800px;
        }
        
        .seo-content ul {
            color: var(--text-secondary);
            margin-left: 20px;
            margin-bottom: 15px;
            line-height: 1.8;
        }
        
        @media (max-width: 600px) {
            h1 { font-size: 1.8rem; }
            .controls { flex-direction: column; }
            .controls input, .controls select, .controls button {
                width: 100%;
            }
            .theme-toggle {
                position: static;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body data-theme="dark">
    <div class="container">
        <header>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                <span id="themeIcon">‚òÄÔ∏è</span>
            </button>
            <h1>üìä Stock vs Gold</h1>
            <p class="subtitle">See stock prices measured in gold, not fiat currency</p>
        </header>
        
        <div class="controls">
            <input type="text" id="ticker" placeholder="Enter ticker (e.g., AAPL, TSLA, MSFT)" value="AAPL" aria-label="Stock ticker symbol">
            <select id="years" aria-label="Time period">
                <option value="1">1 Year</option>
                <option value="5">5 Years</option>
                <option value="10" selected>10 Years</option>
                <option value="20">20 Years</option>
            </select>
            <button id="fetchBtn" onclick="fetchData()">Analyze</button>
        </div>
        
        <div id="error" class="error" style="display: none;" role="alert"></div>
        
        <div id="results" style="display: none;">
            <!-- Price Summary Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>üíµ Price in USD</h3>
                    <div class="value" id="usdPrice">-</div>
                    <div class="change" id="usdChange">-</div>
                </div>
                <div class="stat-card">
                    <h3>ü•á Price in Gold (oz)</h3>
                    <div class="value gold" id="goldPrice">-</div>
                    <div class="change" id="goldChange">-</div>
                </div>
                <div class="stat-card">
                    <h3>üìà Real vs Nominal</h3>
                    <div class="value" id="difference">-</div>
                    <div class="change" id="diffExplain">-</div>
                </div>
            </div>
            
            <!-- Chart Section (moved up) -->
            <div class="toggle-container">
                <label>
                    <input type="checkbox" id="showGold" checked onchange="updateChart()">
                    Show Gold Price (oz)
                </label>
                <label>
                    <input type="checkbox" id="showUsd" onchange="updateChart()">
                    Show USD Price
                </label>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title" id="chartTitle">-</h3>
                <canvas id="priceChart" aria-label="Stock price chart comparing USD and Gold values"></canvas>
            </div>
            
            <!-- Market Cap in Gold Highlight -->
            <div class="highlight-box" id="marketCapBox">
                <h3>üè¶ Market Capitalization</h3>
                <div class="highlight-row">
                    <span>In USD</span>
                    <span class="value" id="marketCapUsd">-</span>
                </div>
                <div class="highlight-row">
                    <span>In Gold</span>
                    <span class="value gold" id="marketCapGold">-</span>
                </div>
                <div class="highlight-row">
                    <span style="color: var(--text-secondary);">Current Gold Price</span>
                    <span id="currentGoldPrice">-</span>
                </div>
            </div>
            
            <!-- Key Metrics Section -->
            <div class="metrics-section">
                <h2>üìä Key Metrics</h2>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="label">P/E Ratio (TTM)</div>
                        <div class="value" id="peRatio">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="label">Forward P/E</div>
                        <div class="value" id="forwardPe">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="label">PEG Ratio</div>
                        <div class="value" id="pegRatio">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="label">Price to Book</div>
                        <div class="value" id="priceToBook">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="label">EPS (TTM)</div>
                        <div class="value" id="eps">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="label">Dividend Yield</div>
                        <div class="value" id="dividendYield">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="label">Profit Margin</div>
                        <div class="value" id="profitMargin">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="label">Debt to Equity</div>
                        <div class="value" id="debtToEquity">-</div>
                    </div>
                </div>
            </div>
            
            <!-- Financials in Gold Section -->
            <div class="metrics-section">
                <h2>ü•á Financials in Gold</h2>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="label">Revenue</div>
                        <div class="value" id="revenueUsd">-</div>
                        <div class="gold-value" id="revenueGold">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="label">Free Cash Flow</div>
                        <div class="value" id="fcfUsd">-</div>
                        <div class="gold-value" id="fcfGold">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="label">52 Week High</div>
                        <div class="value" id="high52w">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="label">52 Week Low</div>
                        <div class="value" id="low52w">-</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="loading" class="loading" style="display: none;">
            Loading data...
        </div>
        
        <!-- SEO Content Section -->
        <section class="seo-content">
            <h2>Why Measure Stock Prices in Gold?</h2>
            <p>
                When you look at stock prices in dollars, you're seeing a distorted picture. The US dollar has lost over 95% of its purchasing power since 1913, and continues to lose value due to inflation and monetary expansion. Gold, however, has maintained its purchasing power for thousands of years.
            </p>
            
            <h3>The Problem with Fiat Currency Measurements</h3>
            <p>
                A stock that went from $10 to $100 over 20 years might seem like a 10x return. But if the dollar lost 60% of its purchasing power during that time, your "gains" are largely an illusion. You need 2.5x more dollars just to maintain the same purchasing power.
            </p>
            
            <h3>Gold as a Stable Measuring Stick</h3>
            <p>
                Gold has been money for over 5,000 years. Unlike fiat currencies, it cannot be printed or debased by governments. When you measure stock prices in gold ounces, you see the real value creation (or destruction) of a company over time.
            </p>
            
            <h3>What This Tool Shows You</h3>
            <ul>
                <li><strong>Price in Gold (oz):</strong> How many ounces of gold one share costs</li>
                <li><strong>Real vs Nominal Returns:</strong> The difference between USD gains and gold-adjusted gains</li>
                <li><strong>Market Cap in Gold:</strong> The company's total value measured in gold ounces</li>
                <li><strong>Key Metrics:</strong> P/E ratio, PEG, dividend yield, and more</li>
            </ul>
            
            <h3>How to Use Stock vs Gold</h3>
            <p>
                Enter any stock ticker symbol (like AAPL for Apple, TSLA for Tesla, or MSFT for Microsoft), select your time period, and click Analyze. The tool will fetch historical data and calculate the stock's price in gold terms, showing you the real performance beyond inflation.
            </p>
        </section>
        
        <footer>
            <p>Data from Yahoo Finance ‚Ä¢ Gold = Gold Futures (GC=F)</p>
            <p>Built with ‚ö° by <a href="https://github.com/robapuros/stock-vs-gold">clawdbot</a> | <a href="https://github.com/robapuros/stock-vs-gold">View on GitHub</a></p>
        </footer>
    </div>
    
    <script>
        let chartInstance = null;
        let currentData = null;
        
        // Theme handling
        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('themeIcon');
            if (body.dataset.theme === 'dark') {
                body.dataset.theme = 'light';
                icon.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                body.dataset.theme = 'dark';
                icon.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
            // Update chart colors if exists
            if (chartInstance) {
                updateChart();
            }
        }
        
        // Load saved theme
        function loadTheme() {
            const saved = localStorage.getItem('theme');
            if (saved === 'light') {
                document.body.dataset.theme = 'light';
                document.getElementById('themeIcon').textContent = 'üåô';
            }
        }
        
        function formatNumber(num) {
            if (num === null || num === undefined) return '-';
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toLocaleString();
        }
        
        function formatGoldOz(num) {
            if (num === null || num === undefined) return '-';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B oz';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M oz';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K oz';
            return num.toFixed(2) + ' oz';
        }
        
        async function fetchData() {
            const ticker = document.getElementById('ticker').value.trim().toUpperCase();
            const years = document.getElementById('years').value;
            
            if (!ticker) {
                showError('Please enter a ticker symbol');
                return;
            }
            
            // Update URL for shareability
            const url = new URL(window.location);
            url.searchParams.set('ticker', ticker);
            url.searchParams.set('years', years);
            window.history.replaceState({}, '', url);
            
            document.getElementById('fetchBtn').disabled = true;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            
            try {
                const response = await fetch(`/api/data?ticker=${ticker}&years=${years}`);
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                    return;
                }
                
                currentData = data;
                displayResults(data);
                
                // Update page title for SEO
                document.title = `${data.ticker} Stock Price in Gold | Stock vs Gold`;
                
            } catch (err) {
                showError('Failed to fetch data. Please try again.');
                console.error(err);
            } finally {
                document.getElementById('fetchBtn').disabled = false;
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        function showError(msg) {
            document.getElementById('error').textContent = msg;
            document.getElementById('error').style.display = 'block';
        }
        
        function displayResults(data) {
            const stats = data.stats;
            const metrics = data.metrics;
            
            // USD stats
            document.getElementById('usdPrice').textContent = `$${stats.end_price_usd.toLocaleString()}`;
            const usdChangeEl = document.getElementById('usdChange');
            usdChangeEl.textContent = `${stats.change_usd_pct >= 0 ? '+' : ''}${stats.change_usd_pct}% (from $${stats.start_price_usd.toLocaleString()})`;
            usdChangeEl.className = 'change ' + (stats.change_usd_pct >= 0 ? 'positive' : 'negative');
            
            // Gold stats
            document.getElementById('goldPrice').textContent = `${stats.end_price_gold.toFixed(4)} oz`;
            const goldChangeEl = document.getElementById('goldChange');
            goldChangeEl.textContent = `${stats.change_gold_pct >= 0 ? '+' : ''}${stats.change_gold_pct}% (from ${stats.start_price_gold.toFixed(4)} oz)`;
            goldChangeEl.className = 'change ' + (stats.change_gold_pct >= 0 ? 'positive' : 'negative');
            
            // Difference
            const diff = stats.change_usd_pct - stats.change_gold_pct;
            const diffEl = document.getElementById('difference');
            diffEl.textContent = `${diff >= 0 ? '+' : ''}${diff.toFixed(1)}%`;
            diffEl.className = 'value ' + (diff >= 0 ? 'positive' : 'negative');
            
            const explainEl = document.getElementById('diffExplain');
            if (diff > 0) {
                explainEl.textContent = 'USD gains overstated vs gold';
            } else if (diff < 0) {
                explainEl.textContent = 'Stock lost value in real (gold) terms';
            } else {
                explainEl.textContent = 'Same performance in both';
            }
            
            // Market Cap
            document.getElementById('marketCapUsd').textContent = metrics.market_cap_usd ? '$' + formatNumber(metrics.market_cap_usd) : '-';
            document.getElementById('marketCapGold').textContent = metrics.market_cap_gold ? formatGoldOz(metrics.market_cap_gold) : '-';
            document.getElementById('currentGoldPrice').textContent = metrics.current_gold_price ? '$' + metrics.current_gold_price.toLocaleString() + '/oz' : '-';
            
            // Key Metrics
            document.getElementById('peRatio').textContent = metrics.pe_ratio ?? '-';
            document.getElementById('forwardPe').textContent = metrics.forward_pe ?? '-';
            document.getElementById('pegRatio').textContent = metrics.peg_ratio ?? '-';
            document.getElementById('priceToBook').textContent = metrics.price_to_book ?? '-';
            document.getElementById('eps').textContent = metrics.eps ? '$' + metrics.eps : '-';
            document.getElementById('dividendYield').textContent = metrics.dividend_yield ? metrics.dividend_yield + '%' : '-';
            document.getElementById('profitMargin').textContent = metrics.profit_margin ? metrics.profit_margin + '%' : '-';
            document.getElementById('debtToEquity').textContent = metrics.debt_to_equity ?? '-';
            
            // Financials in Gold
            document.getElementById('revenueUsd').textContent = metrics.revenue_usd ? '$' + formatNumber(metrics.revenue_usd) : '-';
            document.getElementById('revenueGold').textContent = metrics.revenue_gold ? 'ü•á ' + formatGoldOz(metrics.revenue_gold) : '-';
            document.getElementById('fcfUsd').textContent = metrics.free_cash_flow_usd ? '$' + formatNumber(metrics.free_cash_flow_usd) : '-';
            document.getElementById('fcfGold').textContent = metrics.free_cash_flow_gold ? 'ü•á ' + formatGoldOz(metrics.free_cash_flow_gold) : '-';
            document.getElementById('high52w').textContent = metrics['52w_high'] ? '$' + metrics['52w_high'].toLocaleString() : '-';
            document.getElementById('low52w').textContent = metrics['52w_low'] ? '$' + metrics['52w_low'].toLocaleString() : '-';
            
            document.getElementById('chartTitle').textContent = 
                `${data.company_name} (${data.ticker}) - Price History`;
            
            document.getElementById('results').style.display = 'block';
            updateChart();
        }
        
        function updateChart() {
            if (!currentData) return;
            
            const showGold = document.getElementById('showGold').checked;
            const showUsd = document.getElementById('showUsd').checked;
            const isDark = document.body.dataset.theme === 'dark';
            
            const textColor = isDark ? '#888' : '#555';
            const gridColor = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
            const goldColor = isDark ? '#ffd700' : '#c9a000';
            const greenColor = isDark ? '#4ade80' : '#16a34a';
            
            const datasets = [];
            
            if (showGold) {
                datasets.push({
                    label: 'Price in Gold (oz)',
                    data: currentData.stock_in_gold,
                    borderColor: goldColor,
                    backgroundColor: isDark ? 'rgba(255, 215, 0, 0.1)' : 'rgba(201, 160, 0, 0.1)',
                    fill: true,
                    tension: 0.1,
                    yAxisID: 'y'
                });
            }
            
            if (showUsd) {
                datasets.push({
                    label: 'Price in USD',
                    data: currentData.stock_usd,
                    borderColor: greenColor,
                    backgroundColor: isDark ? 'rgba(74, 222, 128, 0.1)' : 'rgba(22, 163, 74, 0.1)',
                    fill: true,
                    tension: 0.1,
                    yAxisID: 'y1'
                });
            }
            
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            const scales = {
                x: {
                    ticks: { color: textColor, maxTicksLimit: 10 },
                    grid: { color: gridColor }
                },
                y: {
                    type: 'linear',
                    display: showGold,
                    position: 'left',
                    title: { display: true, text: 'Gold (oz)', color: goldColor },
                    ticks: { color: goldColor },
                    grid: { color: isDark ? 'rgba(255,215,0,0.1)' : 'rgba(201,160,0,0.1)' }
                }
            };
            
            if (showUsd) {
                scales.y1 = {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: { display: true, text: 'USD ($)', color: greenColor },
                    ticks: { color: greenColor },
                    grid: { drawOnChartArea: false }
                };
            }
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: currentData.dates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            labels: { color: textColor }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.dataset.yAxisID === 'y') {
                                        return `${context.dataset.label}: ${context.raw.toFixed(4)} oz`;
                                    }
                                    return `${context.dataset.label}: $${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: scales
                }
            });
        }
        
        // Allow Enter key to submit
        document.getElementById('ticker').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') fetchData();
        });
        
        // Load from URL params
        function loadFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const ticker = params.get('ticker');
            const years = params.get('years');
            if (ticker) document.getElementById('ticker').value = ticker;
            if (years) document.getElementById('years').value = years;
        }
        
        // Initialize
        window.onload = function() {
            loadTheme();
            loadFromUrl();
            fetchData();
        };
    </script>
</body>
</html>
